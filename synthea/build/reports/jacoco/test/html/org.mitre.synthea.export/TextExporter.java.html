<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TextExporter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">synthea</a> &gt; <a href="index.source.html" class="el_package">org.mitre.synthea.export</a> &gt; <span class="el_source">TextExporter.java</span></div><h1>TextExporter.java</h1><pre class="source lang-java linenums">package org.mitre.synthea.export;

import static org.mitre.synthea.export.ExportHelper.dateFromTimestamp;

import com.google.common.base.Strings;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardOpenOption;
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;

import org.apache.commons.text.WordUtils;
import org.mitre.synthea.world.agents.Clinician;
import org.mitre.synthea.world.agents.Person;
import org.mitre.synthea.world.concepts.HealthRecord.CarePlan;
import org.mitre.synthea.world.concepts.HealthRecord.Code;
import org.mitre.synthea.world.concepts.HealthRecord.Encounter;
import org.mitre.synthea.world.concepts.HealthRecord.Entry;
import org.mitre.synthea.world.concepts.HealthRecord.ImagingStudy;
import org.mitre.synthea.world.concepts.HealthRecord.Medication;
import org.mitre.synthea.world.concepts.HealthRecord.Observation;
import org.mitre.synthea.world.concepts.HealthRecord.Procedure;
import org.mitre.synthea.world.concepts.HealthRecord.Report;

/**
 * Exporter for a simple human-readable text format per person.
 * Sample: &lt;pre&gt;
 * Colleen Wilkinson
 * =================
 * Race:                White
 * Ethnicity:           Non-Hispanic
 * Gender:              M
 * Age:                 51
 * Birth Date:          1966-10-26
 * Marital Status:
 * Provider: MCLEAN HOSPITAL CORPORATION
 * --------------------------------------------------------------------------------
 * ALLERGIES:
 * --------------------------------------------------------------------------------
 * MEDICATIONS:
 * 2016-12-28[STOPPED] : Amoxicillin 250 MG for Sinusitis
 * 2016-10-26[CURRENT] : 3 ML liraglutide 6 MG/ML Pen Injector for Diabetes
 * 2016-10-26[CURRENT] : 24 HR Metformin hydrochloride for Diabetes
 * --------------------------------------------------------------------------------
 * CONDITIONS:
 * 2016-12-28 - 2017-01-18 : Viral sinusitis (disorder)
 * 2016-10-26 -            : Diabetes
 * 2015-11-04 - 2015-11-18 : Acute viral pharyngitis (disorder)
 * --------------------------------------------------------------------------------
 * CARE PLANS:
 * 2016-10-26[CURRENT] : Diabetes self management plan
 *                          Reason: Diabetes
 *                          Activity: Diabetic diet
 *                          Activity: Exercise therapy
 * 2010-09-15[STOPPED] : Fracture care
 *                          Reason: Fracture subluxation of wrist
 *                          Activity: Recommendation to rest
 *                          Activity: Physical activity target light exercise
 * --------------------------------------------------------------------------------
 * OBSERVATIONS:
 * 2017-11-01 : Blood Pressure
 *            - Diastolic Blood Pressure                 76.0 mmHg
 *            - Systolic Blood Pressure                  117.8 mmHg
 * 2017-11-01 : Body Mass Index                          37.2 kg/m2
 * 2017-11-01 : Body Weight                              122.7 kg
 * 2017-11-01 : Body Height                              181.6 cm
 * --------------------------------------------------------------------------------
 * ENCOUNTERS:
 * 2017-11-01 : Encounter for check up (procedure)
 * 2016-12-28 : Encounter for Viral sinusitis (disorder)
 * 2016-10-26 : Encounter for check up (procedure)
 * &lt;/pre&gt;

 * Exporter for a simple human-readable text format per encounter.
 * Sample: &lt;pre&gt; 
 * Chia293 Rohan584
 * ================
 * Race:                White
 * Ethnicity:           Non-Hispanic
 * Gender:              F
 * Age:                 4
 * Birth Date:          2014-04-12
 * Marital Status:      S
 * Outpatient Provider: BEVERLY HOSPITAL CORPORATION
 * --------------------------------------------------------------------------------
 * ALLERGIES:
 *  2015-01-27 : Allergy to wheat
 *  2015-01-27 : Allergy to tree pollen
 *  2015-01-27 : Allergy to grass pollen
 *  2015-01-27 : Dander (animal) allergy
 *  2015-01-27 : Allergy to mould
 *  2015-01-27 : Allergy to bee venom
 * --------------------------------------------------------------------------------
 * ENCOUNTER
 * 2016-06-01 : Encounter for Acute bronchitis (disorder)
 * Location: BEVERLY HOSPITAL CORPORATION
 * Type: ambulatory
 *   
 *  MEDICATIONS:
 *  2016-06-01 : Acetaminophen 160 MG for Acute bronchitis (disorder)
 *   
 *  CONDITIONS:
 *  2016-06-01 : Acute bronchitis (disorder)
 *  
 *  CARE PLANS:
 *  2016-06-01 : Respiratory therapy
 *                        Reason: Acute bronchitis (disorder)
 *                        Activity: Recommendation to avoid exercise
 *                        Activity: Deep breathing and coughing exercises
 *  
 *  OBSERVATIONS:
 *   
 *  PROCEDURES:
 *  2016-06-01 : Measurement of respiratory function (procedure) for Acute bronchitis (disorder)
 *   
 *  IMMUNIZATIONS:
 *   
 *  IMAGING STUDIES:
 *   
 * --------------------------------------------------------------------------------
 * CONTINUING
 *   
 *  CONDITIONS:
 *  2015-01-14 : Atopic dermatitis
 *  2016-04-18 : Childhood asthma
 *  
 *  MEDICATIONS:
 *  2015-01-27 : 0.3 ML EPINEPHrine 0.5 MG/ML Auto-Injector
 *  2015-01-27 : Loratadine 5 MG Chewable Tablet
 *  2016-04-18 + 200 ACTUAT Albuterol 0.09 MG/ACTUAT Metered Dose Inhaler for Childhood asthma
 *  2016-04-18 + 120 ACTUAT Fluticasone propionate 0.044 MG/ACTUAT Metered Dose
 *              Inhaler for Childhood asthma
 *   
 *  CAREPLANS:
 *  2015-01-14 : Skin condition care
 *                        Reason: Atopic dermatitis
 *                        Activity: Application of moisturizer to skin
 *  2015-01-27 : Self care
 *                        Activity: Allergy education
 *                        Activity: Food allergy diet
 *                        Activity: Allergy education
 *  2016-04-18 : Asthma self management
 *                        Reason: Childhood asthma
 *                        Activity: Inhaled steroid therapy
 *                        Activity: Home nebulizer therapy
 *                        Activity: Breathing control
 *   
 * --------------------------------------------------------------------------------
 * &lt;/pre&gt;
 */

<span class="nc" id="L157">public class TextExporter {</span>

  /**
   * Produce and export a person's record in the text format.
   *
   * @param person Person to export
   * @param fileTag Tag to add to the filename
   * @param time Time the simulation ended
   * @throws IOException if any error occurs writing to the standard export location
   */
  public static void exportAll(Person person, String fileTag, long time) throws IOException {

<span class="fc" id="L169">    List&lt;Encounter&gt; encounters = person.record.encounters;</span>
<span class="fc" id="L170">    List&lt;Entry&gt; conditions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L171">    List&lt;Entry&gt; allergies = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L172">    List&lt;Report&gt; reports = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L173">    List&lt;Observation&gt; observations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L174">    List&lt;Procedure&gt; procedures = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L175">    List&lt;Medication&gt; medications = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L176">    List&lt;Entry&gt; immunizations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L177">    List&lt;CarePlan&gt; careplans = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L178">    List&lt;ImagingStudy&gt; imagingStudies = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L180" title="All 2 branches covered.">    for (Encounter encounter : person.record.encounters) {</span>
<span class="fc" id="L181">      conditions.addAll(encounter.conditions);</span>
<span class="fc" id="L182">      allergies.addAll(encounter.allergies);</span>
<span class="fc" id="L183">      reports.addAll(encounter.reports);</span>
<span class="fc" id="L184">      observations.addAll(encounter.observations);</span>
<span class="fc" id="L185">      procedures.addAll(encounter.procedures);</span>
<span class="fc" id="L186">      medications.addAll(encounter.medications);</span>
<span class="fc" id="L187">      immunizations.addAll(encounter.immunizations);</span>
<span class="fc" id="L188">      careplans.addAll(encounter.careplans);</span>
<span class="fc" id="L189">      imagingStudies.addAll(encounter.imagingStudies);</span>
<span class="fc" id="L190">    }</span>

    // reverse these items so they are displayed in reverse chrono order
<span class="fc" id="L193">    Collections.reverse(encounters);</span>
<span class="fc" id="L194">    Collections.reverse(conditions);</span>
<span class="fc" id="L195">    Collections.reverse(allergies);</span>
<span class="fc" id="L196">    Collections.reverse(reports);</span>
<span class="fc" id="L197">    Collections.reverse(observations);</span>
<span class="fc" id="L198">    Collections.reverse(procedures);</span>
<span class="fc" id="L199">    Collections.reverse(medications);</span>
<span class="fc" id="L200">    Collections.reverse(immunizations);</span>
<span class="fc" id="L201">    Collections.reverse(careplans);</span>
<span class="fc" id="L202">    Collections.reverse(imagingStudies);</span>

    // now we finally start writing things
<span class="fc" id="L205">    List&lt;String&gt; textRecord = new LinkedList&lt;&gt;();</span>

<span class="fc" id="L207">    basicInfo(textRecord, person, time);</span>
<span class="fc" id="L208">    breakline(textRecord);</span>

<span class="fc" id="L210">    textRecord.add(&quot;ALLERGIES:&quot;);</span>
<span class="pc bpc" id="L211" title="1 of 2 branches missed.">    if (allergies.isEmpty()) {</span>
<span class="fc" id="L212">      textRecord.add(&quot;No Known Allergies&quot;);</span>
    } else {
<span class="nc bnc" id="L214" title="All 2 branches missed.">      for (Entry allergy : allergies) {</span>
<span class="nc" id="L215">        condition(textRecord, allergy, true);</span>
<span class="nc" id="L216">      }</span>
    }
<span class="fc" id="L218">    breakline(textRecord);</span>

<span class="fc" id="L220">    textRecord.add(&quot;MEDICATIONS:&quot;);</span>
<span class="fc bfc" id="L221" title="All 2 branches covered.">    for (Medication medication : medications) {</span>
<span class="fc" id="L222">      medication(textRecord, medication, true);</span>
<span class="fc" id="L223">    }</span>
<span class="fc" id="L224">    breakline(textRecord);</span>

<span class="fc" id="L226">    textRecord.add(&quot;CONDITIONS:&quot;);</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">    for (Entry condition : conditions) {</span>
<span class="fc" id="L228">      condition(textRecord, condition, true);</span>
<span class="fc" id="L229">    }</span>
<span class="fc" id="L230">    breakline(textRecord);</span>

<span class="fc" id="L232">    textRecord.add(&quot;CARE PLANS:&quot;);</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">    for (CarePlan careplan : careplans) {</span>
<span class="fc" id="L234">      careplan(textRecord, careplan, true);</span>
<span class="fc" id="L235">    }</span>
<span class="fc" id="L236">    breakline(textRecord);</span>

<span class="fc" id="L238">    textRecord.add(&quot;REPORTS:&quot;);</span>
<span class="fc bfc" id="L239" title="All 2 branches covered.">    for (Report report : reports) {</span>
<span class="fc" id="L240">      diagnosticReport(textRecord, report);</span>
<span class="fc" id="L241">    }</span>
<span class="fc" id="L242">    breakline(textRecord);</span>
    
<span class="fc" id="L244">    textRecord.add(&quot;OBSERVATIONS:&quot;);</span>
<span class="fc bfc" id="L245" title="All 2 branches covered.">    for (Observation observation : observations) {</span>
<span class="fc" id="L246">      observation(textRecord, observation);</span>
<span class="fc" id="L247">    }</span>
<span class="fc" id="L248">    breakline(textRecord);</span>

<span class="fc" id="L250">    textRecord.add(&quot;PROCEDURES:&quot;);</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">    for (Procedure procedure : procedures) {</span>
<span class="fc" id="L252">      procedure(textRecord, procedure);</span>
<span class="fc" id="L253">    }</span>
<span class="fc" id="L254">    breakline(textRecord);</span>

<span class="fc" id="L256">    textRecord.add(&quot;IMMUNIZATIONS:&quot;);</span>
<span class="fc bfc" id="L257" title="All 2 branches covered.">    for (Entry immunization : immunizations) {</span>
<span class="fc" id="L258">      immunization(textRecord, immunization);</span>
<span class="fc" id="L259">    }</span>
<span class="fc" id="L260">    breakline(textRecord);</span>

<span class="fc" id="L262">    textRecord.add(&quot;ENCOUNTERS:&quot;);</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">    for (Encounter encounter : encounters) {</span>
<span class="fc" id="L264">      encounter(textRecord, encounter);</span>
<span class="fc" id="L265">    }</span>
<span class="fc" id="L266">    breakline(textRecord);</span>

<span class="fc" id="L268">    textRecord.add(&quot;IMAGING STUDIES:&quot;);</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">    for (ImagingStudy imagingStudy : imagingStudies) {</span>
<span class="nc" id="L270">      imagingStudy(textRecord, imagingStudy);</span>
<span class="nc" id="L271">    }</span>
<span class="fc" id="L272">    breakline(textRecord);</span>

    // finally write to the file
<span class="fc" id="L275">    File outDirectory = Exporter.getOutputFolder(&quot;text&quot;, person);</span>
<span class="fc" id="L276">    Path outFilePath = outDirectory.toPath().resolve(Exporter.filename(person, fileTag, &quot;txt&quot;));</span>
<span class="fc" id="L277">    Files.write(outFilePath, textRecord, StandardOpenOption.CREATE_NEW);</span>
<span class="fc" id="L278">  }</span>

  /**
   * Produce and export a person's record in text format.
   * 
   * @param person Person
   * @param time Time the simulation ended
   * @throws IOException if any error occurs writing to the standard export location
   */
  public static void exportEncounter(Person person, long time) throws IOException {
<span class="fc" id="L288">    List&lt;Encounter&gt; encounters = person.record.encounters;</span>
<span class="fc" id="L289">    List&lt;Entry&gt; conditions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L290">    List&lt;Entry&gt; allergies = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L291">    List&lt;Medication&gt; medications = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L292">    List&lt;CarePlan&gt; careplans = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L294" title="All 2 branches covered.">    for (Encounter encounter : person.record.encounters) {</span>
<span class="fc" id="L295">      conditions.addAll(encounter.conditions);</span>
<span class="fc" id="L296">      allergies.addAll(encounter.allergies);</span>
<span class="fc" id="L297">      medications.addAll(encounter.medications);</span>
<span class="fc" id="L298">      careplans.addAll(encounter.careplans);</span>
<span class="fc" id="L299">    }</span>

    // reverse these items so they are displayed in reverse chrono order
<span class="fc" id="L302">    Collections.reverse(encounters);</span>
<span class="fc" id="L303">    Collections.reverse(conditions);</span>
<span class="fc" id="L304">    Collections.reverse(allergies);</span>
<span class="fc" id="L305">    Collections.reverse(medications);</span>
<span class="fc" id="L306">    Collections.reverse(careplans);</span>
    
    //set an integer that will be used as a counter for file naming purposes
<span class="fc" id="L309">    int encounterNumber = 0;</span>

<span class="fc bfc" id="L311" title="All 2 branches covered.">    for (Encounter encounter : encounters) {</span>
      //make a record for each encounter to write information
<span class="fc" id="L313">      List&lt;String&gt; textRecord = new LinkedList&lt;&gt;();</span>
            
<span class="fc" id="L315">      basicInfo(textRecord, person, time);</span>
<span class="fc" id="L316">      breakline(textRecord);</span>

<span class="fc" id="L318">      textRecord.add(&quot;ALLERGIES:&quot;);</span>
<span class="pc bpc" id="L319" title="1 of 2 branches missed.">      if (allergies.isEmpty()) {</span>
<span class="fc" id="L320">        textRecord.add(&quot;No Known Allergies&quot;);</span>
      } else {
<span class="nc bnc" id="L322" title="All 2 branches missed.">        for (Entry allergy : allergies) {</span>
<span class="nc" id="L323">          condition(textRecord, allergy, false);</span>
<span class="nc" id="L324">        }</span>
      }
<span class="fc" id="L326">      breakline(textRecord);</span>

<span class="fc" id="L328">      textRecord.add(&quot;ENCOUNTER&quot;);</span>
<span class="fc" id="L329">      encounterReport(textRecord, person, encounter);</span>
<span class="fc" id="L330">      breakline(textRecord);</span>

<span class="fc" id="L332">      textRecord.add(&quot;CONTINUING&quot;);</span>
<span class="fc" id="L333">      textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L335">      textRecord.add(&quot;   CONDITIONS:&quot;);</span>
<span class="fc bfc" id="L336" title="All 2 branches covered.">      for (Entry condition : conditions) {</span>
<span class="fc" id="L337">        conditionpast(textRecord, condition, encounter);</span>
<span class="fc" id="L338">      }</span>
<span class="fc" id="L339">      textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L341">      textRecord.add(&quot;   MEDICATIONS:&quot;);</span>
<span class="fc bfc" id="L342" title="All 2 branches covered.">      for (Medication medication : medications) {</span>
<span class="fc" id="L343">        medicationpast(textRecord, medication, encounter);</span>
<span class="fc" id="L344">      }</span>
<span class="fc" id="L345">      textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L347">      textRecord.add(&quot;   CAREPLANS:&quot;);</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">      for (CarePlan careplan : careplans) {</span>
<span class="fc" id="L349">        careplanpast(textRecord, careplan, encounter);</span>
<span class="fc" id="L350">      }</span>
<span class="fc" id="L351">      textRecord.add(&quot;   &quot;);</span>
<span class="fc" id="L352">      breakline(textRecord);</span>

<span class="fc" id="L354">      encounterNumber++;</span>

      //write to the file
<span class="fc" id="L357">      File outDirectory2 = Exporter.getOutputFolder(&quot;text_encounters&quot;, person);</span>
<span class="fc" id="L358">      Path outFilePath2 = outDirectory2.toPath().resolve(Exporter.filename(person,</span>
<span class="fc" id="L359">          Integer.toString(encounterNumber), &quot;txt&quot;));</span>
<span class="fc" id="L360">      Files.write(outFilePath2, textRecord, StandardOpenOption.CREATE_NEW);</span>
<span class="fc" id="L361">    }      </span>
<span class="fc" id="L362">  }  </span>
  
  /**
   * Add the basic information to the record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param person
   *          The person to export
   * @param endTime
   *          Time the simulation ended (to calculate age/deceased status)
   */
  private static void basicInfo(List&lt;String&gt; textRecord, Person person, long endTime) {
<span class="fc" id="L375">    String name = (String) person.attributes.get(Person.NAME);</span>

<span class="fc" id="L377">    textRecord.add(name);</span>
<span class="fc" id="L378">    textRecord.add(name.replaceAll(&quot;[A-Za-z0-9 ]&quot;, &quot;=&quot;)); // &quot;underline&quot; the characters in the name</span>

<span class="fc" id="L380">    String race = (String) person.attributes.get(Person.RACE);</span>
<span class="fc bfc" id="L381" title="All 2 branches covered.">    if (race.equals(&quot;hispanic&quot;)) {</span>
<span class="fc" id="L382">      textRecord.add(&quot;Race:                Other&quot;);</span>
<span class="fc" id="L383">      String ethnicity = (String) person.attributes.get(Person.ETHNICITY);</span>
<span class="fc" id="L384">      ethnicity = WordUtils.capitalize(ethnicity.replace('_', ' '));</span>
<span class="fc" id="L385">      textRecord.add(&quot;Ethnicity:           &quot; + ethnicity);</span>
<span class="fc" id="L386">    } else {</span>
<span class="fc" id="L387">      textRecord.add(&quot;Race:                &quot; + WordUtils.capitalize(race));</span>
<span class="fc" id="L388">      textRecord.add(&quot;Ethnicity:           Non-Hispanic&quot;);</span>
    }

<span class="fc" id="L391">    textRecord.add(&quot;Gender:              &quot; + person.attributes.get(Person.GENDER));</span>

<span class="pc bpc" id="L393" title="1 of 2 branches missed.">    String age = person.alive(endTime) ? Integer.toString(person.ageInYears(endTime)) : &quot;DECEASED&quot;;</span>
<span class="fc" id="L394">    textRecord.add(&quot;Age:                 &quot; + age);</span>

<span class="fc" id="L396">    String birthdate = dateFromTimestamp((long) person.attributes.get(Person.BIRTHDATE));</span>
<span class="fc" id="L397">    textRecord.add(&quot;Birth Date:          &quot; + birthdate);</span>
<span class="fc" id="L398">    textRecord.add(&quot;Marital Status:      &quot;</span>
<span class="fc" id="L399">        + person.attributes.getOrDefault(Person.MARITAL_STATUS, &quot;S&quot;));</span>

<span class="pc bpc" id="L401" title="1 of 2 branches missed.">    if (person.record.provider != null) {</span>
<span class="nc" id="L402">      textRecord.add(&quot;Provider:            &quot; + person.record.provider.name);</span>
<span class="nc" id="L403">      textRecord.add(&quot;Provider Address:    &quot; + person.record.provider.address</span>
         + &quot;, &quot; + person.record.provider.city + &quot;, &quot; + person.record.provider.state);
    }
<span class="fc" id="L406">  }</span>
  
  /**
   * Write a line for a single Encounter to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param encounter
   *          The Encounter to add to the export
   */
  private static void encounter(List&lt;String&gt; textRecord, Encounter encounter) {
<span class="fc" id="L417">    String encounterTime = dateFromTimestamp(encounter.start);</span>

<span class="fc" id="L419">    String clinician = &quot;&quot;;</span>
<span class="pc bpc" id="L420" title="1 of 2 branches missed.">    if (encounter.clinician != null) {</span>
<span class="fc" id="L421">      clinician = &quot; (&quot; + encounter.clinician.attributes.get(Clinician.NAME_PREFIX) </span>
<span class="fc" id="L422">          + &quot; &quot; + encounter.clinician.attributes.get(Clinician.NAME) + &quot;)&quot;;</span>
    }
<span class="pc bpc" id="L424" title="1 of 4 branches missed.">    if (encounter.reason == null &amp;&amp; encounter.provider == null) {</span>
<span class="nc" id="L425">      textRecord.add(encounterTime + clinician + &quot; : &quot; + encounter.codes.get(0).display);</span>
<span class="pc bpc" id="L426" title="1 of 4 branches missed.">    } else if  (encounter.reason == null &amp;&amp; encounter.provider != null) {</span>
<span class="fc" id="L427">      textRecord.add(encounterTime + clinician + &quot; : Encounter at &quot; + encounter.provider.name);</span>
<span class="pc bpc" id="L428" title="2 of 4 branches missed.">    } else if  (encounter.reason != null &amp;&amp; encounter.provider == null) {</span>
<span class="nc" id="L429">      textRecord.add(encounterTime + clinician + &quot; : Encounter for &quot; + encounter.reason.display);</span>
    } else {
<span class="fc" id="L431">      textRecord.add(encounterTime + clinician + &quot; : Encounter at &quot; </span>
          + encounter.provider.name + &quot; : Encounter for &quot; + encounter.reason.display);
    }
<span class="fc" id="L434">  } </span>

  /**
   * Add all info from the encounter to the record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param person
   *          The person to export
   * @param encounter
   *          The encounter all of the information refers to
   */
  private static void encounterReport(List&lt;String&gt; textRecord, Person person, Encounter encounter) {
<span class="fc" id="L447">    String encounterTime = dateFromTimestamp(encounter.start);</span>

<span class="pc bpc" id="L449" title="1 of 4 branches missed.">    if (encounter.reason == null &amp;&amp; encounter.provider == null) {</span>
<span class="nc" id="L450">      textRecord.add(encounterTime + &quot; : &quot; + encounter.codes.get(0).display);</span>
<span class="pc bpc" id="L451" title="1 of 4 branches missed.">    } else if (encounter.reason == null &amp;&amp; encounter.provider != null) {</span>
<span class="fc" id="L452">      textRecord.add(encounterTime + &quot; : Encounter at &quot; + encounter.provider.name);</span>
<span class="pc bpc" id="L453" title="2 of 4 branches missed.">    } else if (encounter.reason != null &amp;&amp; encounter.provider == null) {</span>
<span class="nc" id="L454">      textRecord.add(encounterTime + &quot; : Encounter for &quot; + encounter.reason.display);</span>
    } else {
<span class="fc" id="L456">      textRecord.add(encounterTime + &quot; : Encounter at &quot; + encounter.provider.name</span>
          + &quot; : Encounter for &quot; + encounter.reason.display);
    }

<span class="fc" id="L460">    textRecord.add(&quot;Type: &quot; + encounter.type);</span>
<span class="fc" id="L461">    textRecord.add(&quot;   &quot;);</span>

    //Create lists for only the items that occurred at the encounter
<span class="fc" id="L464">    List&lt;Entry&gt; encounterConditions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L465">    List&lt;Report&gt; encounterReports = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L466">    List&lt;Observation&gt; encounterObservations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L467">    List&lt;Procedure&gt; encounterProcedures = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L468">    List&lt;Medication&gt; encounterMedications = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L469">    List&lt;Entry&gt; encounterImmunizations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L470">    List&lt;CarePlan&gt; encounterCareplans = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L471">    List&lt;ImagingStudy&gt; encounterImagingStudies = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L473">    encounterConditions.addAll(encounter.conditions);</span>
<span class="fc" id="L474">    encounterReports.addAll(encounter.reports);</span>
<span class="fc" id="L475">    encounterObservations.addAll(encounter.observations);</span>
<span class="fc" id="L476">    encounterProcedures.addAll(encounter.procedures);</span>
<span class="fc" id="L477">    encounterMedications.addAll(encounter.medications);</span>
<span class="fc" id="L478">    encounterImmunizations.addAll(encounter.immunizations);</span>
<span class="fc" id="L479">    encounterCareplans.addAll(encounter.careplans);</span>
<span class="fc" id="L480">    encounterImagingStudies.addAll(encounter.imagingStudies);</span>

<span class="fc" id="L482">    Collections.reverse(encounterConditions);</span>
<span class="fc" id="L483">    Collections.reverse(encounterObservations);</span>
<span class="fc" id="L484">    Collections.reverse(encounterProcedures);</span>
<span class="fc" id="L485">    Collections.reverse(encounterMedications);</span>
<span class="fc" id="L486">    Collections.reverse(encounterImmunizations);</span>
<span class="fc" id="L487">    Collections.reverse(encounterCareplans);</span>
<span class="fc" id="L488">    Collections.reverse(encounterImagingStudies);</span>

<span class="fc" id="L490">    textRecord.add(&quot;   MEDICATIONS:&quot;);</span>
<span class="fc bfc" id="L491" title="All 2 branches covered.">    for (Medication medication : encounterMedications) {</span>
<span class="fc" id="L492">      medication(textRecord, medication, false);</span>
<span class="fc" id="L493">    }</span>
<span class="fc" id="L494">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L496">    textRecord.add(&quot;   CONDITIONS:&quot;);</span>
<span class="fc bfc" id="L497" title="All 2 branches covered.">    for (Entry condition : encounterConditions) {</span>
<span class="fc" id="L498">      condition(textRecord, condition, false);</span>
<span class="fc" id="L499">    }</span>
<span class="fc" id="L500">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L502">    textRecord.add(&quot;   CARE PLANS:&quot;);</span>
<span class="fc bfc" id="L503" title="All 2 branches covered.">    for (CarePlan careplan : encounterCareplans) {</span>
<span class="fc" id="L504">      careplan(textRecord, careplan, false);</span>
<span class="fc" id="L505">    }</span>
<span class="fc" id="L506">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L508">    textRecord.add(&quot;   REPORTS:&quot;);</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">    for (Report report : encounterReports) {</span>
<span class="fc" id="L510">      diagnosticReport(textRecord, report);</span>
<span class="fc" id="L511">    }</span>
<span class="fc" id="L512">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L514">    textRecord.add(&quot;   OBSERVATIONS:&quot;);</span>
<span class="fc bfc" id="L515" title="All 2 branches covered.">    for (Observation observation : encounterObservations) {</span>
<span class="fc" id="L516">      observation(textRecord, observation);</span>
<span class="fc" id="L517">    }</span>
<span class="fc" id="L518">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L520">    textRecord.add(&quot;   PROCEDURES:&quot;);</span>
<span class="fc bfc" id="L521" title="All 2 branches covered.">    for (Procedure procedure : encounterProcedures) {</span>
<span class="fc" id="L522">      procedure(textRecord, procedure);</span>
<span class="fc" id="L523">    }</span>
<span class="fc" id="L524">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L526">    textRecord.add(&quot;   IMMUNIZATIONS:&quot;);</span>
<span class="fc bfc" id="L527" title="All 2 branches covered.">    for (Entry immunization : encounterImmunizations) {</span>
<span class="fc" id="L528">      immunization(textRecord, immunization);</span>
<span class="fc" id="L529">    }</span>
<span class="fc" id="L530">    textRecord.add(&quot;   &quot;);</span>

<span class="fc" id="L532">    textRecord.add(&quot;   IMAGING STUDIES:&quot;);</span>
<span class="pc bpc" id="L533" title="1 of 2 branches missed.">    for (ImagingStudy imagingStudy : encounterImagingStudies) {</span>
<span class="nc" id="L534">      imagingStudy(textRecord, imagingStudy);</span>
<span class="nc" id="L535">    }</span>
<span class="fc" id="L536">    textRecord.add(&quot;   &quot;);</span>
<span class="fc" id="L537">  }</span>

  /**
   * Write a line for a single Condition to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param condition
   *          The condition to add to the export
   * @param end
   *          Whether or not the condition end date will be displayed
   */
  private static void condition(List&lt;String&gt; textRecord, Entry condition, Boolean end) {
<span class="fc" id="L550">    String start = dateFromTimestamp(condition.start);</span>
    String stop;
<span class="fc" id="L552">    String description = condition.codes.get(0).display;</span>
<span class="fc bfc" id="L553" title="All 2 branches covered.">    if (end) {</span>
<span class="fc bfc" id="L554" title="All 2 branches covered.">      if (condition.stop == 0L) {</span>
        //     &quot;YYYY-MM-DD&quot;
<span class="fc" id="L556">        stop = &quot;          &quot;;</span>
      } else {
<span class="fc" id="L558">        stop = dateFromTimestamp(condition.stop);</span>
      }
<span class="fc" id="L560">      textRecord.add(&quot;  &quot; + start + &quot; - &quot; + stop + &quot; : &quot; + description);</span>
    } else {
<span class="fc" id="L562">      textRecord.add(&quot;  &quot; + start + &quot; : &quot; + description);</span>
    }
<span class="fc" id="L564">  }</span>

  /**
   * Write a line for a condition that has not ended at the time of the encounter.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param condition
   *          The condition to add to the export
   * @param encounter
   *          The encounter at which the continuing condition is reported
   */
  private static void conditionpast(List&lt;String&gt; textRecord, Entry condition, Encounter encounter) {
<span class="fc" id="L577">    String start = dateFromTimestamp(condition.start);</span>
<span class="fc bfc" id="L578" title="All 6 branches covered.">    if ((condition.stop == 0L || condition.stop &gt; encounter.stop)</span>
        &amp;&amp; (condition.start &lt; encounter.start)) {
      //checks that the condition hasn't ended by the time of the encounter
      //and began prior to the encounter
<span class="fc" id="L582">      String description = condition.codes.get(0).display;</span>
<span class="fc" id="L583">      textRecord.add(&quot;  &quot; + start + &quot; : &quot; + description);</span>
    }
<span class="fc" id="L585">  }</span>

  /**
   * Write a line for a single Observation to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param observation
   *          The Observation to add to the export
   */
  private static void observation(List&lt;String&gt; textRecord, Observation observation) {
<span class="fc" id="L596">    String value = ExportHelper.getObservationValue(observation);</span>

<span class="fc bfc" id="L598" title="All 2 branches covered.">    if (value == null) {</span>
<span class="pc bpc" id="L599" title="2 of 4 branches missed.">      if (observation.observations != null &amp;&amp; !observation.observations.isEmpty()) {</span>
        // handoff to multiobservation, ex for blood pressure
<span class="fc" id="L601">        multiobservation(textRecord, observation);</span>
      }

      // no value so nothing more to report here
<span class="fc" id="L605">      return;</span>
    }

<span class="fc" id="L608">    String obsTime = dateFromTimestamp(observation.start);</span>
<span class="fc" id="L609">    String obsDesc = observation.codes.get(0).display;</span>

<span class="pc bpc" id="L611" title="1 of 2 branches missed.">    String unit = observation.unit != null ? observation.unit : &quot;&quot;;</span>

<span class="fc" id="L613">    textRecord.add(&quot;  &quot; + obsTime + &quot; : &quot; + Strings.padEnd(obsDesc, 40, ' ') + &quot; &quot; </span>
        + value + &quot; &quot; + unit);
<span class="fc" id="L615">  }</span>

  /**
   * Write lines for a Diagnostic Report to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param observation
   *          The Report to add to the export
   */
  private static void diagnosticReport(List&lt;String&gt; textRecord, Report report) {
    // note that this is largely the same as the MultiObservation
<span class="fc" id="L627">    String obsTime = dateFromTimestamp(report.start);</span>
<span class="fc" id="L628">    String obsDesc = report.codes.get(0).display;</span>

<span class="fc" id="L630">    textRecord.add(&quot;  &quot; + obsTime + &quot; : &quot; + obsDesc);</span>
    
<span class="fc" id="L632">    observationGroup(textRecord, report.observations);</span>
<span class="fc" id="L633">  }</span>
  
  /**
   * Write lines for an Observation with multiple parts to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param observation
   *          The Observation to add to the export
   */
  private static void multiobservation(List&lt;String&gt; textRecord, Observation observation) {
<span class="fc" id="L644">    String obsTime = dateFromTimestamp(observation.start);</span>
<span class="fc" id="L645">    String obsDesc = observation.codes.get(0).display;</span>

<span class="fc" id="L647">    textRecord.add(&quot;  &quot; + obsTime + &quot; : &quot; + obsDesc);</span>

<span class="fc" id="L649">    observationGroup(textRecord, observation.observations);</span>
<span class="fc" id="L650">  }</span>
  
  /**
   * Common logic for outputting a group of observations,
   * intended to be used by MultiObservations and DiagnosticReports.
   * @param textRecord
   *          Text format record, as a list of lines
   * @param observation
   *          The group of Observations to add to the export
   */
  private static void observationGroup(List&lt;String&gt; textRecord, List&lt;Observation&gt; subObservations) {
<span class="fc bfc" id="L661" title="All 2 branches covered.">    for (Observation subObs : subObservations) {</span>
<span class="fc" id="L662">      String value = ExportHelper.getObservationValue(subObs);</span>
<span class="pc bpc" id="L663" title="1 of 2 branches missed.">      String unit = subObs.unit != null ? subObs.unit : &quot;&quot;;</span>
<span class="fc" id="L664">      String subObsDesc = subObs.codes.get(0).display;</span>
<span class="fc" id="L665">      textRecord.add(&quot;           - &quot; + Strings.padEnd(subObsDesc, 40, ' ') + &quot; &quot; + value + &quot; &quot;</span>
          + unit);
<span class="fc" id="L667">    }</span>
<span class="fc" id="L668">  }</span>

  /**
   * Write a line for a single Procedure to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param procedure
   *          The Procedure to add to the export
   */
  private static void procedure(List&lt;String&gt; textRecord, Procedure procedure) {
<span class="fc" id="L679">    String procedureTime = dateFromTimestamp(procedure.start);</span>
<span class="fc" id="L680">    String procedureDesc = procedure.codes.get(0).display;</span>
<span class="pc bpc" id="L681" title="1 of 4 branches missed.">    if (procedure.reasons == null || procedure.reasons.isEmpty()) {</span>
<span class="fc" id="L682">      textRecord.add(&quot;  &quot; + procedureTime + &quot; : &quot; + procedureDesc);</span>
    } else {
<span class="fc" id="L684">      String reason = procedure.reasons.get(0).display;</span>
<span class="fc" id="L685">      textRecord.add(&quot;  &quot; + procedureTime + &quot; : &quot; + procedureDesc + &quot; for &quot; + reason);</span>
    }
<span class="fc" id="L687">  }</span>

  /**
   * Write a line for a single Medication to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param medication
   *          The Medication to add to the export
   * @param stat
   *          Whether or not the medication status will be displayed
   */
  private static void medication(List&lt;String&gt; textRecord, Medication medication, Boolean stat) {
<span class="fc" id="L700">    String medTime = dateFromTimestamp(medication.start);</span>
<span class="fc" id="L701">    String medDesc = medication.codes.get(0).display;</span>
<span class="fc bfc" id="L702" title="All 2 branches covered.">    String status = (medication.stop == 0L) ? &quot;CURRENT&quot; : &quot;STOPPED&quot;;</span>
<span class="fc bfc" id="L703" title="All 2 branches covered.">    if (stat) {</span>
<span class="pc bpc" id="L704" title="1 of 4 branches missed.">      if (medication.reasons == null || medication.reasons.isEmpty()) {</span>
<span class="fc" id="L705">        textRecord.add(&quot;  &quot; + medTime + &quot;[&quot; + status + &quot;] : &quot; + medDesc);</span>
      } else {
<span class="fc" id="L707">        String reason = medication.reasons.get(0).display;</span>
<span class="fc" id="L708">        textRecord.add(&quot;  &quot; + medTime + &quot;[&quot; + status + &quot;] : &quot; + medDesc + &quot; for &quot; + reason);</span>
<span class="fc" id="L709">      }</span>
    } else {
<span class="pc bpc" id="L711" title="1 of 4 branches missed.">      if (medication.reasons == null || medication.reasons.isEmpty()) {</span>
<span class="fc" id="L712">        textRecord.add(&quot;  &quot; + medTime + &quot; : &quot; + medDesc);</span>
      } else {
<span class="fc" id="L714">        String reason = medication.reasons.get(0).display;</span>
<span class="fc" id="L715">        textRecord.add(&quot;  &quot; + medTime + &quot; : &quot; + medDesc + &quot; for &quot; + reason);</span>
      }
    }
<span class="fc" id="L718">  }</span>

  /**
   * Write a line for a medication that is still being taken at the time of the encounter.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param medication
   *          The medication to add to the export
   * @param encounter
   *          The encounter at which the continuing medication is reported
   */
  private static void medicationpast(List&lt;String&gt; textRecord, Medication medication,
      Encounter encounter) {
<span class="fc" id="L732">    String medTime = dateFromTimestamp(medication.start);</span>
<span class="fc" id="L733">    String medDesc = medication.codes.get(0).display;</span>
<span class="fc bfc" id="L734" title="All 6 branches covered.">    if ((medication.stop == 0L || medication.stop &gt; encounter.stop) </span>
        &amp;&amp; (medication.start &lt; encounter.start)) {
      //checks that the medication is still being taken at the time of the encounter
      //and began prior to the encounter
<span class="pc bpc" id="L738" title="1 of 4 branches missed.">      if (medication.reasons == null || medication.reasons.isEmpty()) {</span>
<span class="fc" id="L739">        textRecord.add(&quot;  &quot; + medTime + &quot; : &quot; + medDesc);</span>
      } else {
<span class="fc" id="L741">        String reason = medication.reasons.get(0).display;</span>
<span class="fc" id="L742">        textRecord.add(&quot;  &quot; + medTime + &quot; + &quot; + medDesc  + &quot; for &quot; + reason);</span>
      }
    }
<span class="fc" id="L745">  }</span>

  /**
   * Write a line for a single Immunization to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param immunization
   *          The immunization to add to the export
   */
  private static void immunization(List&lt;String&gt; textRecord, Entry immunization) {
<span class="fc" id="L756">    String immTime = dateFromTimestamp(immunization.start);</span>
<span class="fc" id="L757">    String immDesc = immunization.codes.get(0).display;</span>
<span class="fc" id="L758">    textRecord.add(&quot;  &quot; + immTime + &quot; : &quot; + immDesc);</span>
<span class="fc" id="L759">  }</span>

  /**
   * Write lines for a single CarePlan to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param careplan
   *          The CarePlan to add to the export
   * @param stat
   *          Whether or not the careplan status will be displayed
   */
  private static void careplan(List&lt;String&gt; textRecord, CarePlan careplan, Boolean stat) {
<span class="fc" id="L772">    String cpTime = dateFromTimestamp(careplan.start);</span>
<span class="fc" id="L773">    String cpDesc = careplan.codes.get(0).display;</span>
<span class="fc bfc" id="L774" title="All 2 branches covered.">    String status = (careplan.stop == 0L) ? &quot;CURRENT&quot; : &quot;STOPPED&quot;;</span>
<span class="fc bfc" id="L775" title="All 2 branches covered.">    if (stat) {</span>
<span class="fc" id="L776">      textRecord.add(&quot;  &quot; + cpTime + &quot;[&quot; + status + &quot;] : &quot; + cpDesc);</span>
    } else {
<span class="fc" id="L778">      textRecord.add(&quot;  &quot; + cpTime + &quot; : &quot; + cpDesc);</span>
    }
    

<span class="pc bpc" id="L782" title="2 of 4 branches missed.">    if (careplan.reasons != null &amp;&amp; !careplan.reasons.isEmpty()) {</span>
<span class="fc bfc" id="L783" title="All 2 branches covered.">      for (Code reason : careplan.reasons) {</span>
<span class="fc" id="L784">        textRecord.add(&quot;                         Reason: &quot; + reason.display);</span>
<span class="fc" id="L785">      }</span>
    }

<span class="pc bpc" id="L788" title="2 of 4 branches missed.">    if (careplan.activities != null &amp;&amp; !careplan.activities.isEmpty()) {</span>
<span class="fc bfc" id="L789" title="All 2 branches covered.">      for (Code activity : careplan.activities) {</span>
<span class="fc" id="L790">        textRecord.add(&quot;                         Activity: &quot; + activity.display);</span>
<span class="fc" id="L791">      }</span>
    }
<span class="fc" id="L793">  }</span>

  /**
   * Write a line for a careplan that is still being followed at the time of the encounter.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param careplan
   *          The careplan to add to the export
   * @param encounter
   *          The encounter at which the continuing careplan is reported
   */
  private static void careplanpast(List&lt;String&gt; textRecord, CarePlan careplan,
      Encounter encounter) {
<span class="fc" id="L807">    String cpTime = dateFromTimestamp(careplan.start);</span>
<span class="fc" id="L808">    String cpDesc = careplan.codes.get(0).display;</span>
<span class="fc bfc" id="L809" title="All 6 branches covered.">    if ((careplan.stop == 0L || careplan.stop &gt; encounter.stop)</span>
        &amp;&amp; (careplan.start &lt; encounter.start)) {
      //checks that the careplan is still being followed at the time of the encounter
      //and began prior to the encounter
<span class="fc" id="L813">      textRecord.add(&quot;  &quot; + cpTime + &quot; : &quot; + cpDesc);</span>
<span class="pc bpc" id="L814" title="2 of 4 branches missed.">      if (careplan.reasons != null &amp;&amp; !careplan.reasons.isEmpty()) {</span>
<span class="fc bfc" id="L815" title="All 2 branches covered.">        for (Code reason : careplan.reasons) {</span>
<span class="fc" id="L816">          textRecord.add(&quot;                         Reason: &quot; + reason.display);</span>
<span class="fc" id="L817">        }</span>
      }
<span class="pc bpc" id="L819" title="2 of 4 branches missed.">      if (careplan.activities != null &amp;&amp; !careplan.activities.isEmpty()) {</span>
<span class="fc bfc" id="L820" title="All 2 branches covered.">        for (Code activity : careplan.activities) {</span>
<span class="fc" id="L821">          textRecord.add(&quot;                         Activity: &quot; + activity.display);</span>
<span class="fc" id="L822">        }   </span>
      }
    }
<span class="fc" id="L825">  }</span>

  /**
   * Write lines for a single ImagingStudy to the exported record.
   *
   * @param textRecord
   *          Text format record, as a list of lines
   * @param imagingstudy
   *          The ImagingStudy to add to the export
   */
  private static void imagingStudy(List&lt;String&gt; textRecord, ImagingStudy imagingStudy) {
<span class="nc" id="L836">    String studyTime = dateFromTimestamp(imagingStudy.start);</span>
<span class="nc" id="L837">    String modality = imagingStudy.series.get(0).modality.display;</span>
<span class="nc" id="L838">    String bodySite = imagingStudy.series.get(0).bodySite.display;</span>

<span class="nc" id="L840">    textRecord.add(&quot;  &quot; + studyTime + &quot; : &quot; + modality + &quot;, &quot; + bodySite);</span>
<span class="nc" id="L841">  }</span>

  /**
   * Section separator (80 dashes).
   */
<span class="fc" id="L846">  private static final String SECTION_SEPARATOR = String.join(&quot;&quot;, Collections.nCopies(80, &quot;-&quot;));</span>

  /**
   * Add a section separator line to the record.
   *
   * @param textRecord
   *          Record to add separator line to
   */
  private static void breakline(List&lt;String&gt; textRecord) {
<span class="fc" id="L855">    textRecord.add(SECTION_SEPARATOR);</span>
<span class="fc" id="L856">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>